<qti-assessment-item
  xmlns="http://www.imsglobal.org/xsd/imsqtiasi_v3p0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.imsglobal.org/xsd/imsqtiasi_v3p0 https://purl.imsglobal.org/spec/qti/v3p0/schema/xsd/imsqti_asiv3p0_v1p0.xsd"
  time-dependent="false"
  xml:lang="en"
  identifier="ITEM-WATERKRAAN"
  title="waterkraan"
  adaptive="true"
>
  <!-- RESPONSES -->
  <!-- Producten gebruikt -->
  <qti-response-declaration identifier="RSP-A-1" base-type="string" cardinality="multiple" />

  <!-- Watervoetafdruk is -->
  <qti-response-declaration identifier="RSP-B-1" base-type="string" cardinality="single">
    <qti-correct-response>
      <qti-value>A</qti-value>
    </qti-correct-response>
  </qti-response-declaration>

  <!-- Tijdsduur vol -->
  <qti-response-declaration identifier="RSP-C-1" base-type="string" cardinality="single" />

  <!-- Berekening kraan open -->
  <qti-response-declaration identifier="RSP-D-1" base-type="string" cardinality="single" />
  <qti-response-declaration identifier="RSP-D-2" base-type="string" cardinality="single" />

  <!-- OUTCOMES -->

  <!-- Algemeen feedback veld -->
  <qti-outcome-declaration identifier="FBK" cardinality="single" base-type="string" />

  <!-- Opgeteld liters van A -->
  <qti-outcome-declaration identifier="OUT-A" base-type="integer" cardinality="single" />
  <qti-outcome-declaration identifier="PRC-A-NUM-ATTEMPTS" base-type="integer" cardinality="single">
    <qti-default-value>
      <qti-value>0</qti-value>
    </qti-default-value>
  </qti-outcome-declaration>

  <!-- Watervoetafdruk, correct of incorrect -->
  <qti-outcome-declaration identifier="FBK-B" base-type="string" cardinality="single" />
  <qti-outcome-declaration identifier="FBK-B-SHOW" base-type="string" cardinality="single" />


  <qti-outcome-declaration identifier="OUT-D-1" base-type="integer" cardinality="single" />
  <qti-outcome-declaration identifier="OUT-D-2" base-type="string" cardinality="single" />
  <qti-outcome-declaration identifier="OUT-D-3" base-type="integer" cardinality="single" />
  <qti-outcome-declaration identifier="OUT-D-4" base-type="integer" cardinality="single" />

  <qti-outcome-declaration identifier="FBK-D" base-type="string" cardinality="single" />

  <!-- STANDARD OUTCOMES -->
  <qti-outcome-declaration identifier="STEP" cardinality="multiple" base-type="string">
    <qti-default-value>
      <qti-value>A</qti-value>
    </qti-default-value>
  </qti-outcome-declaration>

  <qti-outcome-declaration identifier="SCORE" cardinality="single" base-type="integer">
    <qti-default-value>
      <qti-value>0</qti-value>
    </qti-default-value>
  </qti-outcome-declaration>

  <!-- <qti-stylesheet href="./css/kringloop.css" type="text/css"></qti-stylesheet> -->

  <qti-item-body>
    <!-- <p>SCORE:<qti-printed-variable class="qti-well" identifier="SCORE" /></p> -->

    <qti-feedback-block outcome-identifier="STEP" show-hide="show" identifier="A">
      <qti-content-body>
        <strong>Welke producten heb je vandaag gebruikt?</strong>
        <qti-choice-interaction
          class="qti-input-control-hidden qti-choices-stacking-2"
          max-choices="8" min-choices="0" response-identifier="RSP-A-1">
          <qti-simple-choice identifier="A-2700">
            <span>T-shirt</span>
          <qti-feedback-inline identifier="C" outcome-identifier="STEP"
              show-hide="show">
              <strong>2700 Liter</strong>
            </qti-feedback-inline>
          </qti-simple-choice>
          <qti-simple-choice identifier="B-40">
            <span>Boterham</span>
          <qti-feedback-inline identifier="C"
              outcome-identifier="STEP" show-hide="show">40 Liter</qti-feedback-inline>
          </qti-simple-choice>
          <qti-simple-choice identifier="C-2500">
            <span>Reep chocolade</span>
          <qti-feedback-inline identifier="C"
              outcome-identifier="STEP" show-hide="show">2500 Liter</qti-feedback-inline>
          </qti-simple-choice>
          <qti-simple-choice identifier="D-8000">
            <span>Jeansbroek</span>
          <qti-feedback-inline identifier="C"
              outcome-identifier="STEP" show-hide="show">8000 Liter</qti-feedback-inline>
          </qti-simple-choice>
          <qti-simple-choice identifier="E-30">
            <span>Kop thee</span>
          <qti-feedback-inline identifier="C"
              outcome-identifier="STEP" show-hide="show">30 Liter</qti-feedback-inline>
          </qti-simple-choice>
          <qti-simple-choice identifier="F-10">
            <span>A4-tje</span>
          <qti-feedback-inline identifier="C"
              outcome-identifier="STEP" show-hide="show">10 Liter</qti-feedback-inline>
          </qti-simple-choice>
          <qti-simple-choice identifier="G-70">
            <span>Appel</span>
          <qti-feedback-inline identifier="C"
              outcome-identifier="STEP" show-hide="show">70 Liter</qti-feedback-inline>
          </qti-simple-choice>
          <qti-simple-choice identifier="H-2000">
            <span>Laptop</span>
          <qti-feedback-inline identifier="C"
              outcome-identifier="STEP" show-hide="show">20000 Liter</qti-feedback-inline>
          </qti-simple-choice>

        </qti-choice-interaction>
      </qti-content-body>
    </qti-feedback-block>

    <qti-feedback-block outcome-identifier="STEP" show-hide="show" identifier="B">
      <qti-content-body>

        <p>Ah, deze producten hebben allemaal een watervoetafdruk.</p>
        <p><strong>Weet je wat de
        watervoetafdruk van een product is?</strong></p>
        <qti-choice-interaction
          response-identifier="RSP-B-1">
          <qti-simple-choice identifier="A">De hoeveelheid water die nodig is voor de productie.</qti-simple-choice>
          <qti-simple-choice identifier="B">De mate waarin de producten waterdicht zijn.</qti-simple-choice>
          <qti-simple-choice identifier="C">De mate waarin de zeespiegel stijgt door de productie.</qti-simple-choice>
          <qti-simple-choice identifier="D">De hoeveelheid stappen die nodig zijn om het product van
        water te voorzien.</qti-simple-choice>
        </qti-choice-interaction>
      
      <qti-feedback-inline
          outcome-identifier="FBK-B" show-hide="show" identifier="CORRECT">üëç</qti-feedback-inline>
      <qti-feedback-inline
          outcome-identifier="FBK-B" show-hide="show" identifier="INCORRECT">üòî Helaas, probeer nog
        maar een keer.</qti-feedback-inline>
      <qti-feedback-inline
          outcome-identifier="FBK-B-SHOW" show-hide="show" identifier="SHOW"> Alles wat jij als
        persoon consumeert heeft water nodig bij de productie. Hoe meer water nodig is hoe groter de
        watervoetafdruk. </qti-feedback-inline>
      </qti-content-body>
    </qti-feedback-block>

    <qti-feedback-block outcome-identifier="STEP" show-hide="show" identifier="C">
      <qti-content-body>
        <p>Juist, voor het maken van alles wat je gebruikt is water nodig.</p> 
        
        <p>Je gaat nu
        berekenen hoeveel water er nodig is voor de producten die jij aangevinkt hebt. Pak een lege
        drinkfles van 0,5 liter en houdt deze onder de kraan. Zet de kraan vol open en tel hoe lang
        het duurt voordat de fles vol is. </p>
        <p><strong>Tijdsduur tot volle drinkfles?</strong></p>
      <p><qti-text-entry-interaction
            pattern-mask="[0-9]*"
            response-identifier="RSP-C-1"></qti-text-entry-interaction><span> seconden</span></p>

      </qti-content-body>
    </qti-feedback-block>

    <qti-feedback-block outcome-identifier="STEP" show-hide="show" identifier="D">
      <qti-content-body>
        <strong>Hoe lang moet de kraan vol open staan om jouw gebruikte producten te maken?</strong>
        <p>Voor
        jouw aangevinkte producten is: <qti-printed-variable class="qti-well" identifier="OUT-A" />
        Liter nodig.</p>
        <p>Tijd die kraan vol open moet staan is</p>
       
      <p>
          <qti-text-entry-interaction pattern-mask="[0-9]*" response-identifier="RSP-D-1" /> / 0.5 √ó <qti-text-entry-interaction
            response-identifier="RSP-D-2" /> = <qti-printed-variable class="qti-well"
            identifier="OUT-D-1" />
          <span> seconden</span></p>

      <qti-feedback-block
          outcome-identifier="FBK-D" show-hide="show" identifier="CORRECT">
          <qti-content-body>
            <p>üôÄ HWOAA, dat is wel heel lang, dat is ongeveer: </p><qti-printed-variable
              class="qti-well"
              identifier="OUT-D-2" />

          </qti-content-body>
        </qti-feedback-block>

      <qti-feedback-block
          outcome-identifier="FBK-D" show-hide="show" identifier="INCORRECT">
          <qti-content-body>
            <p> üôÅ Helaas, de berekening zou dit moeten zijn:</p>
          <qti-printed-variable
              class="qti-well"
              identifier="OUT-A" /> / 0.5 √ó <qti-printed-variable class="qti-well"
              identifier="RSP-C-1" /> = <qti-printed-variable class="qti-well"
              identifier="OUT-D-3" />
              <p> Dat is <qti-printed-variable class="qti-well"
                identifier="OUT-D-4" />
            </p>
          </qti-content-body>

        </qti-feedback-block>


      </qti-content-body>
    </qti-feedback-block>

    <p><qti-printed-variable identifier="FBK" /></p>

  </qti-item-body>

  <qti-response-processing>
    <qti-set-outcome-value identifier="STEP">
      <qti-custom-operator class="js.org">
        <qti-base-value base-type="string"><![CDATA[

        function convertSecondsToDHM(seconds) {
          const minutes = Math.floor(seconds / 60);
          const hours = Math.floor(minutes / 60);
          const days = Math.floor(hours / 24);

          return {
            days,
            hours: hours % 24,
            minutes: minutes % 60
          };
        }

        if (!item.getVariable('STEP').value?.includes('B')) {
          if (item.getVariable('RSP-A-1').value?.length > 0) {
            item.updateOutcomeVariable('FBK', '');
            item.updateOutcomeVariable('STEP', 'B');
          }else {
            item.updateOutcomeVariable('FBK', `‚òùÔ∏è Heb je echt niets gebruikt. Anders selecteer maar gewoon
          iets, maakt niet uit wat!`);
            return;
          }
        }

        if (
          item.getVariable('RSP-B-1').value !== null
           && !item.getVariable('STEP').value.includes('C')
        ) {

          if (item.getVariable('RSP-B-1').value == item.getVariable('RSP-B-1').correctResponse) {
           item.updateOutcomeVariable('SCORE', item.getVariable('PRC-A-NUM-ATTEMPTS').value === "0" ? 1 : 0);
            item.updateOutcomeVariable('FBK-B', 'CORRECT');
            item.updateOutcomeVariable('FBK-B-SHOW', '');
            item.updateOutcomeVariable('STEP', 'C');
          } else {
            item.updateOutcomeVariable('FBK-B', 'INCORRECT');
            item.updateOutcomeVariable('FBK-B-SHOW', 'SHOW');
            item.updateOutcomeVariable('PRC-A-NUM-ATTEMPTS',
          (parseInt(item.getVariable('PRC-A-NUM-ATTEMPTS').value) + 1));
          }
        }
        
        if (
          item.getVariable('RSP-C-1').value !== null
           && !item.getVariable('STEP').value.includes('D')
          ) {
           item.updateOutcomeVariable('STEP', 'D');

           const sumReducer = (accumulator, currentValue) => {
            const parsedValue = parseInt(currentValue.substring(2));
            return accumulator + parsedValue;
          };

          const totalSum = item.getVariable('RSP-A-1').value.reduce(sumReducer, 0);
          item.updateOutcomeVariable('OUT-A', totalSum);
        }
   
        if (
          item.getVariable('RSP-D-1').value !== null
          && item.getVariable('RSP-D-2').value !== null
          && item.getVariable('STEP').value !== 'E'
          ) {
            const RSPD1 = item.getVariable('RSP-D-1').value;
            const RSPD2 = item.getVariable('RSP-D-2').value;

            const totalResponse = parseInt(RSPD1) / 0.5 * parseInt(RSPD2);
            item.updateOutcomeVariable('OUT-D-1', totalResponse);

            if (parseInt(RSPD1) === item.getVariable('OUT-A').value 
            && RSPD2 === item.getVariable('RSP-C-1').value) {
              item.updateOutcomeVariable('FBK-D', 'CORRECT');
              item.updateOutcomeVariable('SCORE', (parseInt(item.getVariable('SCORE').value) + 1));

              const DHM = convertSecondsToDHM(totalResponse)

              item.updateOutcomeVariable('OUT-D-2', `
                ${DHM.days > 0 ? `${DHM.days} dagen,`: ``}
                ${DHM.hours > 0 ? `${DHM.hours} uren,`: ``}
                ${DHM.minutes > 0 ? `${DHM.minutes} minuten,`: ``}  `);

            } else {

              const CORD1 = item.getVariable('RSP-C-1').value;
              const CORD2 = item.getVariable('OUT-A').value;

              item.updateOutcomeVariable('FBK-D', 'INCORRECT');
              const totalCorrect = parseInt(CORD1) / 0.5 * parseInt(CORD2);

              const DHM = convertSecondsToDHM(totalCorrect)

              item.updateOutcomeVariable('OUT-D-3', totalCorrect);

             item.updateOutcomeVariable('OUT-D-4', `
              ${DHM.days > 0 ? DHM.days > 1 ? `${DHM.days} dagen, ` : `${DHM.days} dag, ` : ``}
              ${DHM.hours > 0 ? `${DHM.hours} uur, ` : ``}
              ${DHM.minutes > 0 ? DHM.minutes > 1 ? `${DHM.minutes} minuten, ` : `${DHM.minutes} minuut, ` : ``}
            `);
            }
            item.updateOutcomeVariable('STEP', 'E');
          }

        if (item.getVariable('STEP').value.includes('E')
        ) {
          item.updateOutcomeVariable('completionStatus', 'completed'); 
        }
        ]]></qti-base-value>
      </qti-custom-operator>
    </qti-set-outcome-value>
  </qti-response-processing>
</qti-assessment-item>